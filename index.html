<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第19期 チーム希望エントリー</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; -webkit-tap-highlight-color: transparent; }
        .tap-scale:active { transform: scale(0.98); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        // Firebase Configuration (User Provided)
        const firebaseConfig = {
            apiKey: "AIzaSyCesxY149Fx77NDwnplZBCH06dekDcduA4",
            authDomain: "team-entry.firebaseapp.com",
            projectId: "team-entry",
            storageBucket: "team-entry.firebasestorage.app",
            messagingSenderId: "137873897281",
            appId: "1:137873897281:web:67b999f86431d0e20213c0",
            measurementId: "G-KLBEB481CY"
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, onSnapshot, query } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        // Initialize Firebase
        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            console.error("Firebase init error. Config might be missing.", e);
        }
        
        const appId = 'doyukai-19th-team-selector';
        const { useState, useEffect } = React;

        // Icon Helper
        const Icon = ({ name, className }) => {
            useEffect(() => { lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        const TEAMS = [
            { id: 'org', title: '組織・仲間づくり', subtitle: '5月総会・動員・e-doyu', color: 'bg-emerald-50 border-emerald-200 text-emerald-800', icon: 'users', details: ['【主な担当】5月定時総会の設営、動員目標達成', '【繁忙期】4月～5月', '【得られるもの】顔の広さ、組織運営の基礎'] },
            { id: 'vision', title: 'ビジョン・AI', subtitle: '11月フォーラム・AI活用', color: 'bg-blue-50 border-blue-200 text-blue-800', icon: 'target', details: ['【主な担当】11月経営フォーラム、AI勉強会', '【繁忙期】9月～11月', '【得られるもの】最新AIスキル、自社の経営指針'] },
            { id: 'learn', title: '事業承継・学び', subtitle: '実践報告例会・家族例会', color: 'bg-amber-50 border-amber-200 text-amber-800', icon: 'book-open', details: ['【主な担当】家族例会(夏)、実践報告の企画', '【繁忙期】7月～8月', '【得られるもの】深い学び、家族ぐるみの交流'] },
            { id: 'region', title: '地域・広域連携', subtitle: '天草連携・全国行事', color: 'bg-rose-50 border-rose-200 text-rose-800', icon: 'map-pin', details: ['【主な担当】天草合同例会、全国行事動員', '【繁忙期】10月', '【得られるもの】県外・市外との強い繋がり'] }
        ];

        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('entry');
            const [selectedTeam, setSelectedTeam] = useState(null);
            const [name, setName] = useState('');
            const [company, setCompany] = useState('');
            const [choices, setChoices] = useState({ first: null, second: null, third: null });
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [allEntries, setAllEntries] = useState([]);

            useEffect(() => {
                if(!auth) return;
                signInAnonymously(auth);
                onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    if(u) loadData(u.uid);
                });
            }, []);

            const loadData = (uid) => {
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'team_preferences'));
                onSnapshot(q, (snapshot) => {
                    const data = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                    setAllEntries(data);
                    const myEntry = data.find(d => d.id === uid);
                    if (myEntry) {
                        setName(myEntry.name);
                        setCompany(myEntry.company || '');
                        setChoices(myEntry.choices);
                    }
                });
            };

            const handleSelect = (rank, teamId) => {
                setChoices(prev => {
                    const next = { ...prev };
                    if (next.first === teamId) next.first = null;
                    if (next.second === teamId) next.second = null;
                    if
